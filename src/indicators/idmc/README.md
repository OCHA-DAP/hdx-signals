# IDMC

IDMC displacement data is extracted from the IDMC Internal Displacement Updates (IDU)
database. The codebase for extracting, wrangling, and flagging the data is done within
the [idmc](https://github.com/OCHA-DAP/idmc) R package. Details on the database can be
found within the R documentation for the package, but a brief outline is provided below.

## Introduction

By default, data in the IDU is stored as events data, with a single row in the database
a single event in a country with corresponding number of persons displaced, a start date,
and an end date. Data is collected by a team of researchers who monitor media outputs,
humanitarian reports, and other data on displacement for inclusion in the database. Data
generally goes back to the beginning of 2018.

## Methodology

The methodology for its use in the GMS is below.

### Focus on conflict

For the purposes of the GMS, only the conflict data within the IDMC is used for flagging.
This was done because there are natural disasters across a wide range of countries, which
could result in numerous false flags. As well, CERF was more worried about potentially
missing new conflict shocks and resulting displacements than missing natural disasters,
which are ostensibly reported more widely. Thus, the database is filtered to only contain
conflict related displacement.

### Conversion to time series

To facilitate the use of this data for flagging, data is converted
into a time series. For each event, the reported displacement is allocated across all days
from the start to end date inclusive. So an event with 3,000 displaced persons across
January 1 to January 3 would be considered 1,000 persons displaced each day.

For each country, all displacements for each day is summed up to create a dataset of daily
displacement (no reported displacement results in 0). Rolling sums are then calculated
to generate displacement in the past week (7 days), month (30 days), quarter (90 days) and
year (365 days). 

### Individual flagging

Warnings are generated from this time series data. Anomalies are calculated at the weekly
to yearly level. For each country, flags are generated whenever the weekly (up to yearly)
level of displacement is in the 95th percentile or higher historically. As well, global
thresholds are set so that countries with a history of conflict displacement will also
be flagged for new, large scale conflict displacement events. The thresholds are:

- Over 5,000 persons displaced in the past week
- Over 25,000 persons displaced in the past month
- Over 100,000 persons displaced in the past quarter
- Over 500,000 persons displaced in the past year

The anomaly flags are also only generated when the displacement across that
period of time is also above a specific minimum value. If it is below that
value, no flag is generated. These lower limits for flagging are:

- 1,000 persons displaced in the past week
- 5,000 persons displaced in the past month
- 10,000 persons displaced in the past quarter
- 25,000 persons displaced in the past year

Flags are also generated for the first displacement reported in the past 3 months, 6
months, or year.

### Overall flag

The overall flag for the IDMC data is generated by considering all relevant flags. If
there is any flag, then a country is flagged. Then, contiguous dates of flagging are
used to generate a start date (the first date of flagging) and end date (the last day
of flagging). If there is any day in between where there was no flagging, then
they are considered two separate "events". In this way, the IDMC data is reconstituted
into an events dataset, but combining multiple events from the raw data.

Since delays exist in the IDMC reporting, emails are only generated when new
flags are less than 60 days old.

## Output datasets

`flags_idmc.csv`: flagging dataset.

`raw_idmc.csv`: raw IDU output. This includes all reported events used to feed into the
alerts. Can be explored to better contextualize the reported displacement.

`wrangled_idmc.csv`: wrangled displacement data. Includes all time series data (daily to
yearly), whether or not each type of alert was flagged that day, and the total
number of flags for each day as a time series. Useful for plotting time series of
displacement and when flags were generated.
