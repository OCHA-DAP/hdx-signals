---
title: "email"
output: blastula::blastula_email
---


## `r country`

```{r, include=FALSE}
show_table <- flag_source == "idmc"

if (flag_source == "idmc") {
  idmc_drive <- get_drive_file("raw_idmc")
  googledrive::drive_download(file = idmc_drive, path = f <- tempfile(fileext = ".csv"))
  df_idmc_raw <- read_csv(f)
  df_display <- df_idmc_raw %>%
    filter(
      iso3 == !!iso3,
      displacement_end_date >= !!start_date,
      displacement_start_date <= !!end_date
    ) %>%
    distinct(
      event_url, event_name
    ) %>%
    filter(
      !is.na(event_url)
    ) %>%
    transmute(
      Reports = paste0(
        "<a href=\"",
        event_url,
        "\">",
        event_name,
        "</a>"
      )
    )
  
  show_idmc <- show_table & nrow(df_display) > 0
}

```

```{r, results = "asis"}
cat(message)
```

```{r, out.width = 1000, fig.asp = 0.66, dpi = 300}
plot_general(flag_source, iso3, country)
```

### Summary:

```{r, results = "asis"}
cat(summary_experimental)
```

<sub><sup>Context is experimentally generated by the OpenAI `davinci-003` model
available via API, use with caution.</sup></sub>

### Further information:

```{r, results = "asis", out.width = "80%"}
if (flag_source_str == "IDMC") {
  cat(
    paste0(
      "You can refer to the [IDMC country page](",
      url,
      ") for additional context on displacement, and the [IDMC data ",
      "portal](https://www.internal-displacement.org/database/displacement-data) ",
      "to find all relevant data.\n\n",
      "IDMC identified displacement events for this alert from the below reports."
    )
  )
} else if (flag_source_str == "IPC") {
  cat(
    paste0(
      "The latest IPC report can be found [here](",
      url,
      "). Additional information is available on the [IPC website](https://www.ipcinfo.org)."
    )
  )
}
```

```{r, eval = show_table}
if (flag_source == "idmc") {
  # load idmc data
  knitr::kable(
    df_display,
    table.attr = "class=\"scrollable\"",
    format = "html",
    escape = FALSE
    )
}

```

----

